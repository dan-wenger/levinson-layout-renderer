!function(){var e={layoutForm:document.querySelector("#layout-form"),layoutFormSubmit:document.querySelector("#layout-submit"),viewSwitcher:document.querySelector("#view-switcher"),layerNav:document.querySelector("#layer-nav"),keyboard:document.querySelector("#keyboard")},t={data:{},layers:[],layerStack:[],getCurrLayer:function(){return this.layerStack[this.layerStack.length-1]},toLocalStorage:function(e){localStorage.setItem("KBLayoutData",JSON.stringify(e))},fromLocalStorage:function(){return JSON.parse(localStorage.getItem("KBLayoutData"))},localStorageExists:function(){return null!==this.fromLocalStorage()}},r=function(e){var t=e.split(RegExp("(?<=')$","m")),r={};for(i in t){var a=t[i].match(/^\w+$/m)[0],c=n(t[i]).map((function(e,t){return 3===t?o(e,6):o(e)}));r[a]=c}return r},a=function(e){return Object.keys(e).map((function(e){return e}))};function n(e){return e.match(/^\|[^\-].+$/gm)}function o(e,t){for(var r=e.replace(RegExp("((?<=\\|)\\s\\|)|(^\\|)|(\\|$)","g"),"").match(/.{1,8}/g),a=[],n=0;n<r.length;n++)n==t?(a.push("".concat(r[n]).concat(r[n+1])),n++):a.push(r[n]);return a.map((function(e){return e.slice(0,-1)}))}var c={addLayer:function(r){var a=this;t.layerStack.push(r);var n=document.createElement("button");n.innerHTML=r,n.classList.add("layer-btn"),n.id=r,n.onclick=function(){a.clicked(r)},e.layerNav.appendChild(n)},removeLayer:function(e){t.layerStack.pop(),document.getElementById(e).remove()},clicked:function(e){if(e==t.getCurrLayer()){if(t.layerStack.length>1){var r=t.getCurrLayer();this.removeLayer(r);var a=t.getCurrLayer();u.renderLayer(a)}}else{for(var n=t.getCurrLayer();n!==e;)this.removeLayer(n),n=t.getCurrLayer();u.renderLayer(e)}}},u={renderLayer:function(e){var r=t.data[e];this.forAll(e,(function(e,a,n){var o=r[a][n],c=document.getElementById(e);c.classList.remove("pressed"),o.match(/^(\s+)?_+(\s+)?$/m)?(y.addFade(e),y.setContent(e,"")):(y.removeFade(e),y.getTargetLayer(o)===t.getCurrLayer()?(y.setContent(e,y.removeSquareBrackets(o)),c.classList.add("pressed")):y.setContent(e,o))})),this.updateInteractivity()},updateInteractivity:function(){var e=t.getCurrLayer();this.forAll(e,(function(e){!function(e){return t.layers.some((function(t){return e.includes(t)}))}(y.getContent(e))?y.removeInteractivity(e):y.makeInteractive(e)}))},forAll:function(e,r){for(row in l=t.data[e],l)for(col in l[row]){r("".concat(row,"x").concat(col),row,col)}}},y={setContent:function(e,t){document.getElementById(e).getElementsByTagName("span")[0].innerHTML=t},getContent:function(e){return document.getElementById(e).getElementsByTagName("span")[0].innerHTML},getTargetLayer:function(e){return t.layers.find((function(t){return e.includes(t)}))},makeInteractive:function(e){var t=this,r=document.getElementById(e);r.onclick=function(){t.clicked(e)},r.classList.add("clickeable")},removeInteractivity:function(e){var t=document.getElementById(e);t.onclick=null,t.classList.remove("clickeable")},clicked:function(e){var r=this.getContent(e),a=this.getTargetLayer(r);if(a==t.getCurrLayer()){var n=t.getCurrLayer();c.removeLayer(n);var o=t.getCurrLayer();u.renderLayer(o)}else c.addLayer(a),u.renderLayer(a)},addFade:function(e){document.getElementById(e).classList.add("faded")},removeFade:function(e){document.getElementById(e).classList.remove("faded")},removeSquareBrackets:function(e){return e.replaceAll(/(^\[\s?)|(\s?\]$)/gm,"")}};function s(){console.log("going to form view..."),e.keyboard.style.display="none",e.layerNav.style.display="none",e.viewSwitcher.style.display="none",e.layoutForm.style.removeProperty("display")}function d(){console.log("going to keyboard view..."),e.layoutForm.style.display="none",e.keyboard.style.removeProperty("display"),e.layerNav.style.removeProperty("display"),e.viewSwitcher.style.removeProperty("display")}t.localStorageExists()?(t.data=t.fromLocalStorage(),t.layers=a(t.data),d(),c.addLayer("MAIN"),u.renderLayer("MAIN")):s(),e.layoutFormSubmit.addEventListener("click",(function(){var n=e.layoutForm.querySelector("textarea").value;t.data=r(n),t.layers=a(t.data),d(),0==t.layerStack.length&&c.addLayer("MAIN"),u.renderLayer("MAIN"),t.toLocalStorage(t.data)})),e.viewSwitcher.addEventListener("click",s)}();
//# sourceMappingURL=index.e8c35654.js.map
