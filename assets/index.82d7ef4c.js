const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}};p();const c={layoutForm:document.querySelector("#layout-form"),layoutFormSubmit:document.querySelector("#layout-submit"),viewSwitcher:document.querySelector("#view-switcher"),layerNav:document.querySelector("#layer-nav"),keyboard:document.querySelector("#keyboard")},a={data:{},layers:[],layerStack:[],getCurrLayer(){return this.layerStack[this.layerStack.length-1]},toLocalStorage(e){localStorage.setItem("KBLayoutData",JSON.stringify(e))},fromLocalStorage(){return JSON.parse(localStorage.getItem("KBLayoutData"))},localStorageExists(){return this.fromLocalStorage()!==null}},u={layoutData(e){const t=e.split(/(?<=')$/m);let o={};for(let l in t){let r=k(t[l]),s=h(t[l]).map((m,v)=>v===3?g(m,6):g(m));o[r]=s}return o},layerNames(e){return Object.keys(e).map(t=>t)}};function k(e){return e.match(/^\w+$/m)[0]}function h(e){return e.match(/^\|[^\-].+$/gm)}function g(e,t){let l=e.replace(/((?<=\|)\s\|)|(^\|)|(\|$)/g,"").match(/.{1,8}/g),r=[];for(let s=0;s<l.length;s++)s==t?(r.push(`${l[s]}${l[s+1]}`),s++):r.push(l[s]);return r.map(s=>s.slice(0,-1))}const d={addLayer(e){a.layerStack.push(e);let t=document.createElement("button");t.innerHTML=e,t.classList.add("layer-btn"),t.id=e,t.onclick=()=>{this.clicked(e)},c.layerNav.appendChild(t)},removeLayer(e){a.layerStack.pop(),document.getElementById(e).remove()},clicked(e){if(e==a.getCurrLayer()){if(a.layerStack.length>1){const t=a.getCurrLayer();this.removeLayer(t);const o=a.getCurrLayer();i.renderLayer(o)}}else{let t=a.getCurrLayer();for(;t!==e;)this.removeLayer(t),t=a.getCurrLayer();i.renderLayer(e)}}},i={renderLayer(e){let t=a.data[e];this.forAll(e,(o,l,r)=>{let n=t[l][r];const s=document.getElementById(o);s.classList.remove("pressed"),n.match(/^(\s+)?_+(\s+)?$/m)?(y.addFade(o),y.setContent(o,"")):(y.removeFade(o),y.getTargetLayer(n)===a.getCurrLayer()?(y.setContent(o,y.removeSquareBrackets(n)),s.classList.add("pressed")):y.setContent(o,n))}),this.updateInteractivity()},updateInteractivity(){const e=a.getCurrLayer();this.forAll(e,t=>{let o=y.getContent(t);S(o)?y.makeInteractive(t):y.removeInteractivity(t)})},forAll(e,t){const o=a.data[e];for(const l in o)for(const r in o[l]){const n=`${l}x${r}`;t(n,l,r)}}},y={setContent(e,t){let o=document.getElementById(e).getElementsByTagName("span")[0];o.innerHTML=t},getContent(e){return document.getElementById(e).getElementsByTagName("span")[0].innerHTML},getTargetLayer(e){return a.layers.find(t=>e.includes(t))},makeInteractive(e){let t=document.getElementById(e);t.onclick=()=>{this.clicked(e)},t.classList.add("clickeable")},removeInteractivity(e){let t=document.getElementById(e);t.onclick=null,t.classList.remove("clickeable")},clicked(e){const t=this.getContent(e);let o=this.getTargetLayer(t);if(o==a.getCurrLayer()){const l=a.getCurrLayer();d.removeLayer(l);const r=a.getCurrLayer();i.renderLayer(r)}else d.addLayer(o),i.renderLayer(o)},addFade(e){document.getElementById(e).classList.add("faded")},removeFade(e){document.getElementById(e).classList.remove("faded")},removeSquareBrackets(e){return e.replaceAll(/(^\[\s?)|(\s?\]$)/gm,"")}};function S(e){return a.layers.some(t=>e.includes(t))}function w(){const e=c.layoutForm.querySelector("textarea").value;a.data=u.layoutData(e),a.layers=u.layerNames(a.data),f(),a.layerStack.length==0&&d.addLayer("MAIN"),i.renderLayer("MAIN"),a.toLocalStorage(a.data)}function L(){console.log("going to form view..."),c.keyboard.style.display="none",c.layerNav.style.display="none",c.viewSwitcher.style.display="none",c.layoutForm.style.removeProperty("display")}function f(){console.log("going to keyboard view..."),c.layoutForm.style.display="none",c.keyboard.style.removeProperty("display"),c.layerNav.style.removeProperty("display"),c.viewSwitcher.style.removeProperty("display")}a.localStorageExists()?(a.data=a.fromLocalStorage(),a.layers=u.layerNames(a.data),f(),d.addLayer("MAIN"),i.renderLayer("MAIN")):L();c.layoutFormSubmit.addEventListener("click",w);c.viewSwitcher.addEventListener("click",L);
